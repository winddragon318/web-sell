@using Microsoft.AspNetCore.Components.Authorization
@inject NavigationManager Navigation
@inject HttpClient Http

<AuthorizeView>
    <Authorized>
        ﻿<div class="dropdown">
            <button class="btn btn-link text-decoration-none p-0 border-0 user-trigger"
                    type="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false">
                <i class="bi bi-person fs-4"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end custom-dropdown mt-2 border-0 shadow-lg">
                <li>
                    <span class="dropdown-item text-white-50 small text-uppercase fw-bold" style="pointer-events: none;">
                        Hi, @System.Net.WebUtility.UrlDecode(context.User.Identity?.Name)
                    </span>
                </li>
                <li>
                    <a class="dropdown-item text-white d-flex align-items-center gap-2 justify-content-start" href="/account">
                        <i class="bi bi-person"></i>
                        <span>Manage My Account</span>
                    </a>
                </li>

                <li>
                    <a class="dropdown-item text-white d-flex align-items-center gap-2 justify-content-start" href="/orders">
                        <i class="bi bi-bag"></i>
                        <span>My Order</span>
                    </a>
                </li>
                <li>
                    <a class="dropdown-item text-white d-flex align-items-center gap-2 justify-content-start" href="/cancellations">
                        <i class="bi bi-x-circle"></i>
                        <span>My Cancellations</span>
                    </a>
                </li>
                <li>
                    <a class="dropdown-item text-white d-flex align-items-center gap-2 justify-content-start" href="/reviews">
                        <i class="bi bi-star"></i>
                        <span>My Reviews</span>
                    </a>
                </li>
                <li>
                    <a class="dropdown-item text-white d-flex align-items-center gap-2 justify-content-start" href="/logout">
                        <i class="bi bi-box-arrow-right"></i>
                        <span>Logout</span>
                    </a>
                </li>
            </ul>
        </div>
    </Authorized>
</AuthorizeView>

@code {
    private async Task HandleLogout()
    {
        // 1. Gọi API xóa Cookie
        // Lưu ý: Cần đảm bảo AuthController có hàm [HttpPost("logout")]
        await Http.PostAsync("api/auth/logout", null);

        // 2. Reload trang để giao diện cập nhật về trạng thái chưa đăng nhập
        Navigation.NavigateTo("/login", forceLoad: true);
    }
}
